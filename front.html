<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Upload with Tabs</title>
    <style>
        /* Default red-white theme (similar to МТС) */
        body {
            background-color: white;
            color: red;
            font-family: Arial, sans-serif;
        }
        h1, label {
            color: red;
        }
        button, select, input[type="file"] {
            background-color: red;
            color: white;
            border: none;
            padding: 10px;
            font-size: 14px;
            cursor: pointer;
        }
        button:hover {
            background-color: darkred;
        }
        input[type="text"], select {
            padding: 5px;
            margin: 5px 0;
        }
        /* Night mode styles */
        body.night-mode {
            background-color: #121212;
            color: white;
        }
        body.night-mode button, body.night-mode select, body.night-mode input[type="file"] {
            background-color: white;
            color: black;
        }
        /* Cloud image */
        #cloud-image {
            width: 100%;
            height: auto;
        }
        /* Toggle Night Mode Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: red;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Hide elements initially */
        #dropdown2-container, #textInput-container, #fileInput-container {
            display: none;
        }

        /* Tab styles */
        .tab {
            overflow: hidden;
            border-bottom: 1px solid #ccc;
            background-color: white;
        }

        .tab button {
            background-color: inherit;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            font-size: 17px;
            color: red;
        }

        .tab button:hover {
            background-color: lightgray;
        }

        .tab button.active {
            background-color: darkred;
            color: white;
        }

        .tabcontent {
            display: none;
            padding: 6px 12px;
            border-top: none;
        }
    </style>
</head>
<body>
    <!-- Cloud Image -->
    <img src="clowd.png" alt="Cloud Image" id="cloud-image">

    <!-- Tab links -->
    <div class="tab">
        <button class="tablinks" onclick="openTab(event, 'Simple')" id="defaultOpen">Simple</button>
        <button class="tablinks" onclick="openTab(event, 'Advanced')">Advanced</button>
    </div>

    <!-- Simple Tab content -->
    <div id="Simple" class="tabcontent">
        <h1>Welcome to the Simple Tab!</h1>
        <p>This is the simple version of the page.</p>
    
        <!-- Text Input -->
        <label for="simpleTextInput">Enter some text:</label>
        <input type="text" id="simpleTextInput" name="simpleTextInput" oninput="handleSimpleTextInputChange()"><br><br>
    
        <!-- File Input -->
        <input type="file" id="simpleFileInput" name="simpleFile"><br><br>
    
        <button type="button" onclick="uploadSimpleFile()">Upload File</button>
    
        <p id="simpleStatus"></p>
    </div>

    <!-- Advanced Tab content -->
    <div id="Advanced" class="tabcontent">
        <h1>File Upload with Dynamic Dropdowns and Input</h1>

        <!-- Night Mode Toggle -->
        <label for="night-mode-toggle">Night Mode:</label>
        <label class="switch">
            <input type="checkbox" id="night-mode-toggle">
            <span class="slider"></span>
        </label>

        <!-- First Dropdown (File type) -->
        <label for="dropdown1">File type</label>
        <select id="dropdown1" name="option1" onchange="handleDropdown1Change()">
            <option value="">--Please choose an option--</option>
            <option value="txt">txt</option>
            <option value="excel">excel</option>
        </select>
        <br><br>

        <!-- Second Dropdown (Initially hidden) -->
        <div id="dropdown2-container">
            <label for="dropdown2">Diff</label>
            <select id="dropdown2" name="option2" onchange="handleDropdown2Change()">
                <option value="">--Please choose an option--</option>
            </select>
        </div>
        <br><br>

        <!-- Text Input (Initially hidden) -->
        <div id="textInput-container">
            <label for="textInput">Enter some text:</label>
            <input type="text" id="textInput" name="textInput" oninput="handleTextInputChange()"><br><br>
        </div>

        <!-- File Input (Initially hidden) -->
        <div id="fileInput-container">
            <input type="file" id="fileInput" name="file"><br><br>
            <button type="button" onclick="uploadFile()">Upload File</button>
        </div>

        <h2>File Content:</h2>
        <pre id="fileContent"></pre>

        <p id="status"></p>
    </div>

    <script>
        // Night Mode Toggle
        const nightModeToggle = document.getElementById('night-mode-toggle');
        nightModeToggle.addEventListener('change', function() {
            document.body.classList.toggle('night-mode', nightModeToggle.checked);
        });

        // Function to update the second dropdown based on the selection in the first
        function handleDropdown1Change() {
            const dropdown1 = document.getElementById("dropdown1").value;
            const dropdown2 = document.getElementById("dropdown2");
            const dropdown2Container = document.getElementById("dropdown2-container");

            // Clear existing options in second dropdown
            dropdown2.innerHTML = '<option value="">--Please choose an option--</option>';

            if (dropdown1 === "txt") {
                // If "txt" is selected, populate these options
                dropdown2.innerHTML += '<option value="new_line">new line</option>';
                dropdown2.innerHTML += '<option value="my_own">my own</option>';
                dropdown2Container.style.display = "block"; // Show second dropdown
            } else if (dropdown1 === "excel") {
                // If "excel" is selected, populate these options
                dropdown2.innerHTML += '<option value="row">row</option>';
                dropdown2.innerHTML += '<option value="col">col</option>';
                dropdown2.innerHTML += '<option value="idk">idk</option>';
                dropdown2Container.style.display = "block"; // Show second dropdown
            } else {
                // Hide second dropdown if no valid selection
                dropdown2Container.style.display = "none";
                document.getElementById("textInput-container").style.display = "none";
                document.getElementById("fileInput-container").style.display = "none";
            }
        }

        // Function to show text input after selecting the second dropdown option
        function handleDropdown2Change() {
            const dropdown1 = document.getElementById("dropdown1").value;
            const dropdown2 = document.getElementById("dropdown2").value;
            const textInputContainer = document.getElementById("textInput-container");

            // Don't show text input if "txt" is selected in the first dropdown and "newline" is selected in the second
            if (dropdown1 === "txt" && dropdown2 === "plain_text") {
                textInputContainer.style.display = "none"; // Keep text input hidden
                document.getElementById("fileInput-container").style.display = "block"; // Show file input instead
            } else if (dropdown2) {
                textInputContainer.style.display = "block"; // Show text input
            } else {
                textInputContainer.style.display = "none";
                document.getElementById("fileInput-container").style.display = "none";
            }
        }

        // Function to show the file input after the text input is filled
        function handleTextInputChange() {
            const textInput = document.getElementById("textInput").value;
            const fileInputContainer = document.getElementById("fileInput-container");

            if (textInput.trim()) {
                fileInputContainer.style.display = "block"; // Show file input
            } else {
                fileInputContainer.style.display = "none";
            }
        }

        function uploadFile() {
            var formData = new FormData();
            var fileInput = document.getElementById("fileInput");
            var dropdown1 = document.getElementById("dropdown1").value;
            var dropdown2 = document.getElementById("dropdown2").value;
            var textInput = document.getElementById("textInput").value;

            // Check if file is selected, dropdown options are chosen, and text is filled
            if (!fileInput.files.length) {
                document.getElementById("status").innerText = "No file selected!";
                return;
            }

            if (!dropdown1 || !dropdown2) {
                document.getElementById("status").innerText = "Please select both dropdown options!";
                return;
            }

            if (!textInput) {
                document.getElementById("status").innerText = "Please fill out the text input!";
                return;
            }

            formData.append("file", fileInput.files[0]);
            formData.append("file_type", dropdown1);
            formData.append("where_look", dropdown2);
            formData.append("what_look", textInput);

            fetch("/uploadfile/", {
                method: "POST",
                body: formData
            }).then(response => response.json())
              .then(data => {
                //document.getElementById("fileContent").innerText = data.file_content;
                //document.getElementById("status").innerText = `File "${data.file_name}" uploaded successfully with options "${data.option1}" and "${data.option2}", and text "${data.text_input}"!`;
              })
              .catch(error => {
                //document.getElementById("status").innerText = "Error: " + error;
              });
        }
        function handleSimpleTextInputChange() {
            const simpleTextInput = document.getElementById("simpleTextInput").value;
            const simpleFileInputContainer = document.getElementById("simpleFileInput");

            if (simpleTextInput.trim()) {
                simpleFileInputContainer.style.display = "block"; // Show file input
            } else {
                simpleFileInputContainer.style.display = "none"; // Hide file input if text is empty
            }
        }   
        function uploadSimpleFile() {
            var formData = new FormData();
            var simpleTextInput = document.getElementById("simpleTextInput").value;
            var simpleFileInput = document.getElementById("simpleFileInput");

            // Validate if text input is filled
            if (!simpleTextInput.trim()) {
                document.getElementById("simpleStatus").innerText = "Please enter text!";
                return;
            }

            // Validate if file is selected
            if (!simpleFileInput.files.length) {
                document.getElementById("simpleStatus").innerText = "No file selected!";
                return;
            }

            formData.append("what_look", simpleTextInput);
            formData.append("file", simpleFileInput.files[0]);

            fetch("/simple_upload/", {
                method: "POST",
                body: formData
            }).then(response => response.blob())  // Expect the server to return a Blob (image)
            .then(blob => {
                const url = window.URL.createObjectURL(blob);

                // Open the image in a new tab
                window.open(url, '_blank');

                // Trigger a download for the image
                const a = document.createElement('a');
                a.href = url;
                a.download = 'clowd_image.png';  // Set the download file name
                document.body.appendChild(a);
                a.click();  // Trigger the download
                document.body.removeChild(a);  // Clean up the element

                // Revoke the URL after download
                window.URL.revokeObjectURL(url);

                document.getElementById("simpleStatus").innerText = "Image successfully downloaded and opened!";
            })
            .catch(error => {
                document.getElementById("simpleStatus").innerText = "Error: " + error;
            });
        }
        function downloadAndOpenClowdImage() {
            fetch("/get_clowd/")
            .then(response => response.blob())
            .then(blob => {
                const url = window.URL.createObjectURL(blob);  // Create a URL for the blob

                // Open the image in a new tab
                window.open(url, '_blank');

                // Trigger a download for the image
                const a = document.createElement('a');
                a.href = url;
                a.download = 'clowd_image.png';  // Set the download file name
                document.body.appendChild(a);
                a.click();  // Trigger the download
                document.body.removeChild(a);  // Clean up the element

                // Revoke the URL after the download
                window.URL.revokeObjectURL(url);
            })
            .catch(error => {
                document.getElementById("simpleStatus").innerText = "Error downloading the image: " + error;
            });
        }

        function downloadClowdImage() {
            fetch("/get_clowd/")
            .then(response => response.blob())
            .then(blob => {
                const url = window.URL.createObjectURL(new Blob([blob]));
                const a = document.createElement('a');
                a.href = url;
                a.download = 'clowd_image.png';  // Set the download file name
                document.body.appendChild(a);
                a.click();
                a.remove();
            })
            .catch(error => {
                document.getElementById("simpleStatus").innerText = "Error downloading the image: " + error;
            });
        }
        // Tabs functionality
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;

            // Hide all tab contents
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            // Remove the active class from all tablinks
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }

            // Show the current tab and add "active" class to the button that opened it
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        // Open the default tab on page load
        document.getElementById("defaultOpen").click();
    </script>
</body>
</html>
